# Default values for laravel-app Helm chart

# Traefik Ingress Controller
traefik:
  enabled: true
  image:
    repository: traefik
    tag: v3.0
    pullPolicy: IfNotPresent
  
  service:
    type: LoadBalancer
    ports:
      web: 80
      websecure: 443
  
  resources:
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 250m
      memory: 128Mi
  
  # Let's Encrypt configuration
  letsencrypt:
    enabled: true
    email: "admin@example.com"  # Change this to your email
    staging: false  # Set to true for testing (staging certs)
    storage: "/data/acme.json"

# Ingress configuration
ingress:
  enabled: true
  className: traefik
  domains:
    - "example.com"
    - "www.example.com"
  certResolver: letsencrypt  # Uses Traefik's Let's Encrypt resolver
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
    traefik.ingress.kubernetes.io/router.tls: "true"
    traefik.ingress.kubernetes.io/router.tls.certresolver: letsencrypt

# Nginx configuration
nginx:
  enabled: true
  replicaCount: 1
  image:
    repository: nginx
    tag: stable-alpine
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP  # Changed from LoadBalancer to ClusterIP (Traefik handles external traffic)
    port: 80
    targetPort: 80
  
  resources:
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 250m
      memory: 128Mi
  
  config:
    upstream: "php-fpm:9000"
    root: "/var/www/html/public"

# PHP-FPM configuration
php:
  enabled: true
  replicaCount: 1
  image:
    repository: php
    tag: 8.3-fpm-alpine
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 9000
    targetPort: 9000
  
  resources:
    limits:
      cpu: 1000m
      memory: 512Mi
    requests:
      cpu: 500m
      memory: 256Mi
  
  appPath: /var/www/html

# PostgreSQL with PostGIS configuration
postgresql:
  enabled: true
  image:
    repository: postgis/postgis
    tag: "17-master"
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 5432
    targetPort: 5432
  
  persistence:
    enabled: true
    size: 10Gi
    storageClass: ""
    mountPath: /var/lib/postgresql/data
  
  auth:
    username: user
    password: password  # Change this in production!
    database: db
    postgresPassword: password  # Change this in production!
  
  resources:
    limits:
      cpu: 1000m
      memory: 512Mi
    requests:
      cpu: 500m
      memory: 256Mi
  
  healthcheck:
    enabled: true
    interval: 5
    timeout: 5
    retries: 5

# Redis configuration
redis:
  enabled: true
  image:
    repository: redis
    tag: latest
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 6379
    targetPort: 6379
  
  persistence:
    enabled: true
    size: 5Gi
    storageClass: ""
    mountPath: /data
  
  resources:
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 250m
      memory: 128Mi

# Persistent volumes
persistence:
  enabled: true
  storageClass: ""

# Environment variables for PHP container
env:
  APP_ENV: production
  APP_DEBUG: "false"
  APP_KEY: ""
  DB_CONNECTION: pgsql
  DB_HOST: postgresql
  DB_PORT: "5432"
  CACHE_DRIVER: redis
  QUEUE_CONNECTION: redis
  SESSION_DRIVER: redis
  REDIS_HOST: redis

# Secrets (for sensitive data)
secrets:
  enabled: true
  DB_PASSWORD: password
  REDIS_PASSWORD: ""
